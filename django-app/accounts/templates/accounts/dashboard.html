{% load static %}

<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YouniB Dashboard</title>
    <link href="{% static 'css/dashboard.css' %}" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.7.1.js"></script>
    <script src="https://code.jquery.com/ui/1.13.3/jquery-ui.js"></script>
    <link rel="stylesheet" href="https://code.jquery.com/ui/1.13.3/themes/base/jquery-ui.css">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</head>
<body>
    <!-- 상단 네비게이션 바 -->
    <header class="navbar navbar-dark head_younib">
        <div class="container-fluid">
            <h1 class="tit_younib">
                <a href="/dashboard" class="link_tit"><span class="ico_tit">YouniB</span></a>
            </h1>
            <button class="btn_nav" type="button" id="toggleSidebar">☰</button>
            <div class="user-info">
                <span>{{ user.username }} 님 환영합니다!</span>
                <a href="{% url 'accounts:logout' %}">로그아웃</a>
            </div>
        </div>
    </header>

    <!-- 사이드바 -->
    <div class="sidebar" id="sidebar">
        <h1>YouniB</h1>
        <div class="category">Archives</div>
        <ul>
            <li><a href="{% url 'studyarchive:studyarchive' %}">스터디 아카이브</a></li>
            <li><a href="{% url 'quizarchive:quizarchive' %}">퀴즈 아카이브</a></li>
            <li><a href="#studydashboard">스터디 대시보드</a></li>
        </ul>
        <div class="category">My Profile</div>
        <ul>
            <li><a href="{% url 'accounts:profile' %}">나의 프로필</a></li>
            <li><a href="{% url 'accounts:profile_update' %}">프로필 수정</a></li>
            <li><a href="{% url 'accounts:logout' %}">로그아웃</a></li>
        </ul>
    </div>

    <!-- 메인 컨텐츠 -->
    <div class="main-content">
        <div class="file-search">
            <!-- 검색 폼 추가 -->
            <form method="GET" action="{% url 'accounts:search' %}">
                <input type="text" name="q" placeholder="나의 자료 찾아보기" value="{{ query }}">
                <button id="searchButton">검색</button>
            </form>
        </div>

        <div class="recent-files">
            <h3>검색 결과</h3>
            <div class="file-list">
                {% if results %}
                    {% for result in results %}
                        <div class="file-item">{{ result.title }}</div>
                    {% endfor %}
                {% else %}
                    <div class="file-item">검색 결과가 없습니다.</div>
                {% endif %}
            </div>
        </div>

        <div class="recent-files">
            <h3>최근 업로드한 파일</h3>
            <div class="file-list">
                <div class="file-item">파일 1</div>
                <div class="file-item">파일 2</div>
                <div class="file-item">파일 3</div>
            </div>
        </div>
    </div>

    <!-- 푸터 -->
    {% include 'footer.html' %}
    
    <script>
        // 사이드바 토글 기능
        document.getElementById('toggleSidebar').addEventListener('click', function() {
            const sidebar = document.getElementById('sidebar');
            const mainContent = document.querySelector('.main-content');
    
            sidebar.classList.toggle('active');  // 사이드바 활성화/비활성화
            mainContent.classList.toggle('dark'); // 메인 콘텐츠 어두운 색 처리
        });

        // 검색 버튼 클릭 이벤트
        document.getElementById('searchButton').addEventListener('click', function () {
            var query = document.getElementById('searchInput').value;  // 검색어 가져오기
            if (query.trim() === "") {
                alert("검색어를 입력하세요.");
                return;
            }

            // AJAX 요청
            fetch(`/search/?query=${encodeURIComponent(query)}`)
                .then(response => response.json())
                .then(data => {
                    var resultsContainer = document.getElementById('resultsContainer');
                    resultsContainer.innerHTML = "";  // 기존 결과 삭제

                    if (data.results && data.results.length > 0) {
                        // 검색 결과를 동적으로 생성
                        data.results.forEach(result => {
                            var resultItem = document.createElement('div');
                            resultItem.className = "result-item";
                            resultItem.innerHTML = `
                                <h4>${result.name}</h4>
                                <p>${result.description}</p>
                            `;
                            resultsContainer.appendChild(resultItem);
                        });
                    } else {
                        resultsContainer.innerHTML = "<p>검색 결과가 없습니다.</p>";
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                });
        });
    </script>
</body>
</html>
